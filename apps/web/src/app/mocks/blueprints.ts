import type { PlanSessionType, SessionBlueprint, SessionStep } from "./schemas";

import { nowIso } from "~/foundation/lib/time";
import { randomUuidV4 } from "~/foundation/lib/uuid";

function timeProfile(targetMinutes: number): "MICRO" | "STANDARD" | "DEEP" {
  if (targetMinutes <= 10) return "MICRO";
  if (targetMinutes <= 25) return "STANDARD";
  return "DEEP";
}

function difficultyFromLevel(
  level: "novice" | "basic" | "intermediate" | "advanced",
): "beginner" | "intermediate" | "advanced" {
  if (level === "novice" || level === "basic") return "beginner";
  if (level === "intermediate") return "intermediate";
  return "advanced";
}

export function createSessionBlueprint(input: {
  planId: string;
  moduleId: string;
  planSessionId: string;
  sessionType: PlanSessionType;
  planTitle: string;
  moduleTitle: string;
  sessionTitle: string;
  targetMinutes: number;
  blueprintId?: string;
  level?: "novice" | "basic" | "intermediate" | "advanced";
  nextSessionTitle?: string;
}): SessionBlueprint {
  const blueprintId = input.blueprintId ?? randomUuidV4();
  const createdAt = nowIso();
  const profile = timeProfile(input.targetMinutes);
  const difficulty = difficultyFromLevel(input.level ?? "basic");

  if (input.sessionType === "review") {
    return createReviewSessionBlueprint({
      ...input,
      blueprintId,
      createdAt,
      profile,
      difficulty,
    });
  }

  return createDeepSessionBlueprint({
    ...input,
    blueprintId,
    createdAt,
    profile,
    difficulty,
  });
}

// ============================================================
// ë³µìŠµ ì„¸ì…˜ (15ë¶„)
// ============================================================
function createReviewSessionBlueprint(input: {
  planId: string;
  moduleId: string;
  planSessionId: string;
  sessionType: PlanSessionType;
  planTitle: string;
  moduleTitle: string;
  sessionTitle: string;
  targetMinutes: number;
  blueprintId: string;
  createdAt: string;
  profile: "MICRO" | "STANDARD" | "DEEP";
  difficulty: "beginner" | "intermediate" | "advanced";
  nextSessionTitle?: string;
}): SessionBlueprint {
  const steps: Array<SessionStep> = [
    // === 1. ì„¸ì…˜ ì¸íŠ¸ë¡œ ===
    {
      id: "session-intro",
      type: "SESSION_INTRO",
      planTitle: input.planTitle,
      moduleTitle: input.moduleTitle,
      sessionTitle: input.sessionTitle,
      durationMinutes: input.targetMinutes,
      difficulty: input.difficulty,
      learningGoals: [
        "ì´ì „ì— í•™ìŠµí•œ í•µì‹¬ ê°œë… ë¹ ë¥´ê²Œ ë³µê¸°",
        "ê¸°ì–µì´ íë ¤ì§„ ë¶€ë¶„ ì¬í™•ì¸",
        "ì‹¤ìˆ˜í•˜ê¸° ì‰¬ìš´ í¬ì¸íŠ¸ ì ê²€",
      ],
      questionsToCover: [
        "í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?",
        "React 18ì˜ ìë™ ë°°ì¹­ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?",
        "stale closure ë¬¸ì œë¥¼ ì–´ë–»ê²Œ ë°©ì§€í•  ìˆ˜ ìˆë‚˜ìš”?",
      ],
      prerequisites: ["React ê¸°ì´ˆ", "useState Hook"],
      estimatedSeconds: 30,
      intent: "INTRO",
    },

    // === 2. ê°œë… ë³µìŠµ (ê°„ëµ) ===
    {
      id: "concept-review-1",
      type: "CONCEPT",
      title: "í•µì‹¬ ê°œë… ë³µìŠµ: í•¨ìˆ˜í˜• ì—…ë°ì´í„°",
      content: `ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ ì§€ë‚œë²ˆì— ë°°ìš´ **í•¨ìˆ˜í˜• ì—…ë°ì´í„°**ë¥¼ ë‹¤ì‹œ í•œë²ˆ ë³µìŠµí•´ë³¼ê²Œìš”. ğŸ˜Š

## ì ê¹, ì™œ ì´ê²Œ í•„ìš”í–ˆì£ ?

í˜¹ì‹œ ê¸°ì–µë‚˜ì‹œë‚˜ìš”? Reactì—ì„œ \`setCount(count + 1)\`ì²˜ëŸ¼ ìƒíƒœë¥¼ ë°”ê¿€ ë•Œ, ê°€ë” ì´ìƒí•œ ì¼ì´ ìƒê²¼ì–´ìš”. ë²„íŠ¼ì„ ì„¸ ë²ˆ ëˆŒë €ëŠ”ë° 1ë§Œ ì¦ê°€í•œë‹¤ê±°ë‚˜... ğŸ¤”

ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” **í•¨ìˆ˜í˜• ì—…ë°ì´í„°**ë¼ëŠ” ê±¸ ë°°ì› ì£ ! ê°’ì„ ì§ì ‘ ì£¼ëŠ” ëŒ€ì‹ , "ì´ì „ ê°’ì„ ë°›ì•„ì„œ ìƒˆ ê°’ì„ ëŒë ¤ì£¼ëŠ” í•¨ìˆ˜"ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ì—ìš”.

---

## ì€í–‰ ë¹„ìœ , ê¸°ì–µë‚˜ì‹œë‚˜ìš”? ğŸ¦

ì œê°€ ì¢‹ì•„í•˜ëŠ” ë¹„ìœ ì¸ë°ìš”:

**ê¸°ì¡´ ë°©ì‹**: "ì œ ì”ê³ ê°€ 10ë§Œì›ì´ë‹ˆê¹Œ 5ë§Œì› ë¹¼ì„œ 5ë§Œì›ìœ¼ë¡œ í•´ì£¼ì„¸ìš”"  
â†’ ê·¼ë° ê·¸ ì‚¬ì´ì— ëˆ„ê°€ ì…ê¸ˆí–ˆìœ¼ë©´? ì”ê³  ì •ë³´ê°€ ì´ë¯¸ ì˜¤ë˜ëœ ê±°ì˜ˆìš”!

**í•¨ìˆ˜í˜• ì—…ë°ì´í„°**: "ì§€ê¸ˆ ì”ê³ ê°€ ì–¼ë§ˆë“ , ê±°ê¸°ì„œ 5ë§Œì›ë§Œ ë¹¼ì£¼ì„¸ìš”"  
â†’ ì€í–‰(React)ì´ í•­ìƒ ìµœì‹  ì”ê³ ë¥¼ í™•ì¸í•˜ê³  ì²˜ë¦¬í•˜ë‹ˆê¹Œ ì•ˆì „í•´ìš”!

---

## í•µì‹¬ ì§ˆë¬¸ í•˜ë‚˜ë§Œ ê¸°ì–µí•˜ì„¸ìš” ğŸ’¡

ìƒíƒœë¥¼ ë°”ê¿€ ë•Œ ìŠ¤ìŠ¤ë¡œì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”:

> "ìƒˆë¡œìš´ ê°’ì„ ê³„ì‚°í•˜ë ¤ë©´ **ì´ì „ ê°’ì´ í•„ìš”í•œê°€?**"

**"ì‘!"** â†’ í•¨ìˆ˜í˜• ì—…ë°ì´í„° ì“°ì„¸ìš” (\`setCount(prev => prev + 1)\`)
- ì¹´ìš´í„° ì¦ê°€/ê°ì†Œ
- ë°°ì—´ì— í•­ëª© ì¶”ê°€
- í† ê¸€ on/off

**"ì•„ë‹ˆ!"** â†’ ê·¸ëƒ¥ ê°’ ì „ë‹¬í•´ë„ ë¼ìš” (\`setName("í™ê¸¸ë™")\`)
- ì…ë ¥ê°’ ê·¸ëŒ€ë¡œ ì„¤ì •
- API ë°ì´í„°ë¡œ êµì²´

---

## ì„¸ ì¤„ ìš”ì•½ âœ¨

1. **í•­ìƒ ìµœì‹  ìƒíƒœ** - Reactê°€ ê°€ì¥ ìµœì‹  ê°’ì„ ë³´ì¥í•´ì¤˜ìš”
2. **ì—°ì† í˜¸ì¶œ OK** - ë²„íŠ¼ ì—°íƒ€í•´ë„ ì •í™•í•˜ê²Œ ë™ì‘í•´ìš”
3. **ë¹„ë™ê¸°ë„ ì•ˆì „** - setTimeout ì•ˆì—ì„œë„ ë¬¸ì œì—†ì–´ìš”

ì, ì´ì œ ê¸°ì–µì´ ì¢€ ì‚´ì•„ë‚¬ë‚˜ìš”? ë‹¤ìŒìœ¼ë¡œ ê°„ë‹¨í•œ í€´ì¦ˆë¡œ í™•ì¸í•´ë³¼ê²Œìš”! ğŸ’ª`,
      chapterIndex: 1,
      totalChapters: 1,
      estimatedSeconds: 120,
      intent: "EXPLAIN",
    },

    // === 3. ì´í•´ë„ ì²´í¬: í”Œë˜ì‹œì¹´ë“œ ===
    {
      id: "flashcard-1",
      type: "FLASHCARD",
      front:
        "Reactì—ì„œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ 'ì´ì „ ê°’'ì„ ê¸°ë°˜ìœ¼ë¡œ í•´ì•¼ í•œë‹¤ë©´ ì–´ë–¤ íŒ¨í„´ì„ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?",
      back: "í•¨ìˆ˜í˜• ì—…ë°ì´í„° íŒ¨í„´\n\nsetState(prev => prev + 1)\n\nì´ ë°©ì‹ì€ Reactì˜ ë°°ì¹˜ ì—…ë°ì´íŠ¸ì—ì„œë„ í•­ìƒ ìµœì‹  ìƒíƒœë¥¼ ì°¸ì¡°í•˜ë¯€ë¡œ ì•ˆì „í•©ë‹ˆë‹¤.",
      estimatedSeconds: 45,
      intent: "RETRIEVAL",
    },

    // === 4. ì´í•´ë„ ì²´í¬: 4ì§€ì„ ë‹¤ ===
    {
      id: "check-1",
      type: "CHECK",
      question: "ë‹¤ìŒ ì¤‘ stale closure ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì½”ë“œëŠ”?",
      options: [
        "setCount(prev => prev + 1)",
        "setCount(count + 1) // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´",
        "useReducerì˜ dispatch í˜¸ì¶œ",
        "setState({ value: newValue })",
      ],
      answerIndex: 1,
      explanation:
        "ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ì—ì„œ count + 1ì²˜ëŸ¼ ì§ì ‘ ê°’ì„ ì°¸ì¡°í•˜ë©´, í´ë¡œì €ê°€ ìƒì„±ëœ ì‹œì ì˜ count ê°’ì„ ìº¡ì²˜í•˜ê²Œ ë©ë‹ˆë‹¤.",
      estimatedSeconds: 45,
      intent: "RETRIEVAL",
    },

    // === 5. ì´í•´ë„ ì²´í¬: ìŠ¤í”¼ë“œ O/X ===
    {
      id: "speed-ox-1",
      type: "SPEED_OX",
      statement:
        "React 18ì—ì„œëŠ” setTimeout ë‚´ì˜ ì—¬ëŸ¬ setStateë„ ìë™ìœ¼ë¡œ ë°°ì¹­ë©ë‹ˆë‹¤.",
      isTrue: true,
      explanation:
        "ë§ìŠµë‹ˆë‹¤! React 18ë¶€í„°ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¿ë§Œ ì•„ë‹ˆë¼ setTimeout, Promise, fetch ì½œë°± ë“± ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ì—ì„œ ìë™ ë°°ì¹­ì´ ì ìš©ë©ë‹ˆë‹¤.",
      estimatedSeconds: 30,
      intent: "RETRIEVAL",
    },

    // === 6. ì´í•´ë„ ì²´í¬: Cloze ===
    {
      id: "cloze-1",
      type: "CLOZE",
      sentence:
        "í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ìƒíƒœë¥¼ ì¦ê°€ì‹œí‚¤ë ¤ë©´ setCount({{blank}} => {{blank}} + 1)ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.",
      blankId: "prev",
      options: ["prev", "count", "state", "value"],
      answerIndex: 0,
      explanation:
        "prevëŠ” ì´ì „ ìƒíƒœ ê°’ì„ ë‚˜íƒ€ë‚´ëŠ” ê´€ë¡€ì ì¸ ì´ë¦„ì…ë‹ˆë‹¤. ì–´ë–¤ ì´ë¦„ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, prevê°€ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë©ë‹ˆë‹¤.",
      estimatedSeconds: 30,
      intent: "RETRIEVAL",
    },

    // === 7. ì ìš© í™œë™ ===
    {
      id: "application-1",
      type: "APPLICATION",
      scenario:
        "ë‹¹ì‹ ì€ ì‡¼í•‘ëª°ì˜ ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ì„ ê°œë°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ 'ìˆ˜ëŸ‰ +1' ë²„íŠ¼ì„ ë¹ ë¥´ê²Œ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•  ë•Œë„ ì •í™•í•˜ê²Œ ìˆ˜ëŸ‰ì´ ì¦ê°€í•´ì•¼ í•©ë‹ˆë‹¤.",
      question: "ë‹¤ìŒ ì¤‘ ì˜¬ë°”ë¥¸ êµ¬í˜„ ë°©ë²•ì€?",
      options: [
        "setQuantity(quantity + 1)ì„ ì‚¬ìš©í•œë‹¤",
        "setQuantity(prev => prev + 1)ì„ ì‚¬ìš©í•œë‹¤",
        "í´ë¦­ë§ˆë‹¤ setTimeoutì„ ì‚¬ìš©í•˜ì—¬ ì§€ì—°ì‹œí‚¨ë‹¤",
        "useRefë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ëŸ‰ì„ ì €ì¥í•œë‹¤",
      ],
      correctIndex: 1,
      feedback:
        "ì •ë‹µì…ë‹ˆë‹¤! í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ë¹ ë¥¸ ì—°ì† í´ë¦­ì—ì„œë„ ê° ì—…ë°ì´íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ì´ì „ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.",
      estimatedSeconds: 60,
      intent: "PRACTICE",
    },

    // === 8. ì„¸ì…˜ ìš”ì•½ ===
    {
      id: "session-summary",
      type: "SESSION_SUMMARY",
      celebrationEmoji: "ğŸ‰",
      encouragement: "ë³µìŠµì„ ì™„ë£Œí–ˆì–´ìš”! ë°˜ë³µ í•™ìŠµì´ ì¥ê¸° ê¸°ì–µì˜ í•µì‹¬ì…ë‹ˆë‹¤.",
      completedActivities: [
        "í”Œë˜ì‹œì¹´ë“œ 1ê°œ",
        "4ì§€ì„ ë‹¤ í€´ì¦ˆ 1ê°œ",
        "O/X í€´ì¦ˆ 1ê°œ",
        "ë¹ˆì¹¸ ì±„ìš°ê¸° 1ê°œ",
        "ì ìš© ë¬¸ì œ 1ê°œ",
      ],
      keyTakeaways: [
        "í•¨ìˆ˜í˜• ì—…ë°ì´í„°: prev => newValue íŒ¨í„´ìœ¼ë¡œ stale state ë°©ì§€",
        "React 18ì˜ ìë™ ë°°ì¹­ì€ ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‘ë™",
        "ì´ì „ ê°’ì´ í•„ìš”í•˜ë©´ ë°˜ë“œì‹œ í•¨ìˆ˜í˜• ì—…ë°ì´í„° ì‚¬ìš©",
      ],
      nextSessionPreview: input.nextSessionTitle
        ? {
            title: input.nextSessionTitle,
            description: "ë‹¤ìŒ ì„¸ì…˜ì—ì„œ ë” ì‹¬í™”ëœ íŒ¨í„´ì„ í•™ìŠµí•©ë‹ˆë‹¤.",
          }
        : undefined,
      estimatedSeconds: 30,
      intent: "WRAPUP",
    },
  ];

  return {
    schemaVersion: 1,
    blueprintId: input.blueprintId,
    createdAt: input.createdAt,
    context: {
      planId: input.planId,
      moduleId: input.moduleId,
      planSessionId: input.planSessionId,
      sessionType: input.sessionType,
    },
    timeBudget: {
      targetMinutes: input.targetMinutes,
      minMinutes: Math.max(5, Math.floor(input.targetMinutes * 0.6)),
      maxMinutes: Math.min(120, Math.ceil(input.targetMinutes * 1.4)),
      profile: input.profile,
    },
    startStepId: "session-intro",
    steps,
  };
}

// ============================================================
// ë”¥ ì„¸ì…˜ (30ë¶„) - ë³¸í•™ìŠµ
// React ìƒíƒœ ê´€ë¦¬: í•¨ìˆ˜í˜• ì—…ë°ì´í„°ì™€ ë°°ì¹˜ ì—…ë°ì´íŠ¸
// ============================================================
function createDeepSessionBlueprint(input: {
  planId: string;
  moduleId: string;
  planSessionId: string;
  sessionType: PlanSessionType;
  planTitle: string;
  moduleTitle: string;
  sessionTitle: string;
  targetMinutes: number;
  blueprintId: string;
  createdAt: string;
  profile: "MICRO" | "STANDARD" | "DEEP";
  difficulty: "beginner" | "intermediate" | "advanced";
  nextSessionTitle?: string;
}): SessionBlueprint {
  const steps: Array<SessionStep> = [
    // ============================================================
    // 1. ì„¸ì…˜ ì¸íŠ¸ë¡œ (ì²«ë²ˆì§¸ ê³ ì •)
    // ============================================================
    {
      id: "session-intro",
      type: "SESSION_INTRO",
      planTitle: input.planTitle,
      moduleTitle: input.moduleTitle,
      sessionTitle: input.sessionTitle,
      durationMinutes: input.targetMinutes,
      difficulty: input.difficulty,
      learningGoals: [
        "í•¨ìˆ˜í˜• ì—…ë°ì´í„°ì˜ ê°œë…ê³¼ í•„ìš”ì„± ì´í•´",
        "React ë°°ì¹˜ ì—…ë°ì´íŠ¸ ë™ì‘ ì›ë¦¬ íŒŒì•…",
        "useReducerë¥¼ í†µí•œ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬",
        "ì‹¤ë¬´ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” stale closure ë¬¸ì œ í•´ê²°",
      ],
      questionsToCover: [
        "ì™œ setCount(count + 1)ì„ ì„¸ ë²ˆ í˜¸ì¶œí•´ë„ 1ë§Œ ì¦ê°€í• ê¹Œìš”?",
        "React 18ì˜ ìë™ ë°°ì¹­ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?",
        "ì–¸ì œ useState ëŒ€ì‹  useReducerë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?",
        "stale closure ë¬¸ì œë¥¼ ì–´ë–»ê²Œ ë°©ì§€í•  ìˆ˜ ìˆë‚˜ìš”?",
      ],
      prerequisites: ["React ê¸°ì´ˆ", "useState Hook", "ì´ë²¤íŠ¸ í•¸ë“¤ë§"],
      estimatedSeconds: 60,
      intent: "INTRO",
    },

    // ============================================================
    // 2. ê°œë… í•™ìŠµ - ì±•í„° 1: í•¨ìˆ˜í˜• ì—…ë°ì´í„°
    // ============================================================
    {
      id: "concept-1",
      type: "CONCEPT",
      title: "í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë€?",
      content: `ë°˜ê°€ì›Œìš”! ì˜¤ëŠ˜ì€ Reactì—ì„œ ì •ë§ ì¤‘ìš”í•œ ê°œë…ì„ ë°°ì›Œë³¼ ê±°ì˜ˆìš”. ë°”ë¡œ **í•¨ìˆ˜í˜• ì—…ë°ì´í„°**ì…ë‹ˆë‹¤. ğŸ˜Š

## ë¨¼ì € ì§ˆë¬¸ í•˜ë‚˜! ğŸ¤”

Reactì—ì„œ ìƒíƒœë¥¼ ë°”ê¿€ ë•Œ ì–´ë–»ê²Œ í•˜ì‹œë‚˜ìš”? ì•„ë§ˆ ì´ë ‡ê²Œ í•˜ì‹¤ ê±°ì˜ˆìš”:

\`\`\`javascript
setCount(count + 1)  // í˜„ì¬ countì— 1ì„ ë”í•´!
\`\`\`

ì´ê²Œ ë°”ë¡œ **"ê°’ ê¸°ë°˜ ì—…ë°ì´íŠ¸"**ì˜ˆìš”. ì§ê´€ì ì´ê³  ê°„ë‹¨í•˜ì£ ?

í•˜ì§€ë§Œ... ì—¬ê¸°ì— í•¨ì •ì´ ìˆì–´ìš”! ğŸ•³ï¸

---

## ë˜ ë‹¤ë¥¸ ë°©ë²•ì´ ìˆì–´ìš”

ê°’ ëŒ€ì‹  **í•¨ìˆ˜ë¥¼ ì „ë‹¬**í•˜ëŠ” ë°©ë²•ì´ì—ìš”:

\`\`\`javascript
setCount(prev => prev + 1)  // ì´ì „ ê°’ì— 1ì„ ë”í•´ì¤˜!
\`\`\`

"ì–´? ë­ê°€ ë‹¤ë¥¸ ê±°ì§€?" í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”. ê²°ê³¼ëŠ” ê°™ì•„ ë³´ì´ëŠ”ë° ì™œ êµ³ì´ í•¨ìˆ˜ë¡œ ì“°ëƒê³ ìš”.

ì‚¬ì‹¤ ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—” ë‘˜ ë‹¤ ì˜ ë™ì‘í•´ìš”. í•˜ì§€ë§Œ **íŠ¹ì • ìƒí™©**ì—ì„œëŠ” ì²« ë²ˆì§¸ ë°©ì‹ì´ ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆì–´ìš”!

---

## ë¹„ìœ ë¡œ ì‰½ê²Œ ì´í•´í•´ë´ìš” ğŸ“¦

ì˜¨ë¼ì¸ ì‡¼í•‘ì„ í•œë‹¤ê³  ìƒê°í•´ë³´ì„¸ìš”.

**ê°’ ê¸°ë°˜ ë°©ì‹**: "ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í°, ì—ì–´íŒŸì´ ìˆìœ¼ë‹ˆê¹Œ ë§¥ë¶ ë”í•´ì„œ **ì´ 3ê°œë¡œ ë§Œë“¤ì–´ì¤˜**"

â†’ ë§Œì•½ ê·¸ ì‚¬ì´ì— ëˆ„êµ°ê°€ê°€ ì´ë¯¸ ë§¥ë¶ì„ ë„£ì—ˆë‹¤ë©´? "3ê°œ"ë¼ê³  í–ˆìœ¼ë‹ˆ ì˜¤íˆë ¤ ë­”ê°€ê°€ ë¹ ì§ˆ ìˆ˜ë„ ìˆì–´ìš”! ğŸ˜±

**í•¨ìˆ˜í˜• ì—…ë°ì´í„°**: "ì§€ê¸ˆ ì¥ë°”êµ¬ë‹ˆì— ë­ê°€ ìˆë“  ê±°ê¸°ì— **ë§¥ë¶ í•˜ë‚˜ë¥¼ ì¶”ê°€í•´ì¤˜**"

â†’ í˜„ì¬ ìƒíƒœê°€ ë­ë“  ìƒê´€ì—†ì´ "ì¶”ê°€"ë¼ëŠ” ë™ì‘ë§Œ ì •í™•íˆ ìˆ˜í–‰ë¼ìš”! âœ…

---

## í•µì‹¬ ì§ˆë¬¸ í•˜ë‚˜ë§Œ ê¸°ì–µí•˜ì„¸ìš”! ğŸ’¡

ìƒíƒœë¥¼ ë°”ê¿€ ë•Œë§ˆë‹¤ ì´ë ‡ê²Œ ë¬¼ì–´ë³´ì„¸ìš”:

> "ìƒˆë¡œìš´ ê°’ì„ ê³„ì‚°í•˜ë ¤ë©´ **ì´ì „ ê°’ì´ í•„ìš”í•œê°€?**"

**"ì‘!"** â†’ í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì“°ì„¸ìš”
- ì¹´ìš´í„° ì¦ê°€/ê°ì†Œ
- ë°°ì—´ì— í•­ëª© ì¶”ê°€/ì‚­ì œ  
- í† ê¸€ on/off

**"ì•„ë‹ˆ!"** â†’ ê°’ì„ ì§ì ‘ ì „ë‹¬í•´ë„ ë¼ìš”
- ì…ë ¥ì°½ì— ì“´ ì´ë¦„ ê·¸ëŒ€ë¡œ ì €ì¥
- APIì—ì„œ ë°›ì€ ë°ì´í„°ë¡œ ì™„ì „ êµì²´

---

## ì—¬ê¸°ê¹Œì§€ ì •ë¦¬! âœ¨

í•¨ìˆ˜í˜• ì—…ë°ì´í„°ëŠ” Reactì˜ **ì•ˆì „ë§** ê°™ì€ ê±°ì˜ˆìš”. ëŒ€ë¶€ë¶„ì€ ê°’ ê¸°ë°˜ë„ ì˜ ë™ì‘í•˜ì§€ë§Œ, í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì“°ë©´ ì˜ˆìƒ ëª» í•œ ë²„ê·¸ë¥¼ ë¯¸ë¦¬ ë§‰ì„ ìˆ˜ ìˆì£ .

ë‹¤ìŒ ì±•í„°ì—ì„œëŠ” "ì™œ ì´ëŸ° ì¼ì´ ìƒê¸°ëŠ”ì§€" ë” ìì„¸íˆ ì•Œì•„ë³¼ê²Œìš”. í´ë¡œì €ë¼ëŠ” ë…€ì„ ë•Œë¬¸ì¸ë°... ê±±ì • ë§ˆì„¸ìš”, ì–´ë µì§€ ì•Šê²Œ ì„¤ëª…í•´ë“œë¦´ê²Œìš”! ğŸš€`,
      chapterIndex: 1,
      totalChapters: 3,
      estimatedSeconds: 180,
      intent: "EXPLAIN",
    },

    // ============================================================
    // 2. ê°œë… í•™ìŠµ - ì±•í„° 2: ì™œ ë¬¸ì œê°€ ë˜ëŠ”ê°€
    // ============================================================
    {
      id: "concept-2",
      type: "CONCEPT",
      title: "ì™œ ë¬¸ì œê°€ ë˜ëŠ”ê°€?",
      content: `ì, ì´ì œ ì™œ ë¬¸ì œê°€ ìƒê¸°ëŠ”ì§€ ì•Œì•„ë³¼ê²Œìš”! ğŸ•µï¸

## ì´ìƒí•œ ì¼ì´ ë²Œì–´ì ¸ìš” ğŸ¤¨

ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì¹´ìš´í„°ë¥¼ 3 ì¦ê°€ì‹œí‚¤ê³  ì‹¶ì–´ìš”. ê·¸ë˜ì„œ ì´ë ‡ê²Œ ì¼ì–´ìš”:

\`\`\`javascript
function handleClick() {
  setCount(count + 1);  // +1
  setCount(count + 1);  // +1  
  setCount(count + 1);  // +1 = ì´ 3?
}
\`\`\`

ê·¸ëŸ°ë°... ê²°ê³¼ëŠ”ìš”? **1ë§Œ ì¦ê°€í•´ìš”!** ğŸ˜±

"ë­ì•¼, ë²„ê·¸ ì•„ëƒ?" ì‹¶ì£ ? ì•„ë‹ˆì—ìš”, ì´ê±´ JavaScriptì˜ ì •ìƒì ì¸ ë™ì‘ì´ì—ìš”. ê·¼ë° ì™œ ì´ëŸ° ì¼ì´ ìƒê¸¸ê¹Œìš”?

---

## í´ë¡œì €ë¼ëŠ” ë…€ì„ ë•Œë¬¸ì´ì—ìš” ğŸ“¸

"í´ë¡œì €"ë¼ëŠ” ë§ì´ ì–´ë ¤ì›Œ ë³´ì´ì§€ë§Œ, ì‰½ê²Œ ë§í•˜ë©´ ì´ê±°ì˜ˆìš”:

> í•¨ìˆ˜ëŠ” ë§Œë“¤ì–´ì§ˆ ë•Œ ì£¼ë³€ í™˜ê²½ì„ **ì‚¬ì§„ì²˜ëŸ¼ ê¸°ì–µ**í•´ìš”

ì¹œêµ¬ì™€ ì¹´í˜ì—ì„œ ëŒ€í™”í•œë‹¤ê³  ìƒê°í•´ë³´ì„¸ìš”. ì¹œêµ¬ê°€ "ì˜¤ëŠ˜ ë‚ ì”¨ ì¢‹ë‹¤"ë¼ê³  í–ˆì„ ë•Œ, ê·¸ ìˆœê°„ì˜ ë‚ ì”¨ê°€ ê¸°ì–µì— ë‚¨ì–ì•„ìš”. ë‚˜ì¤‘ì— "ì¹œêµ¬ê°€ ë­ë¼ í–ˆì§€?" í•˜ë©´ ê·¸ë•Œ ë³¸ "ì¢‹ì€ ë‚ ì”¨"ë¥¼ ë– ì˜¬ë¦¬ê²Œ ë˜ì£ .

JavaScriptì˜ í•¨ìˆ˜ë„ ë˜‘ê°™ì•„ìš”. í•¨ìˆ˜ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œ ì˜†ì— ìˆë˜ ë³€ìˆ˜ë“¤ì˜ ê°’ì„ **ì°°ì¹µ!** ì°ì–´ì„œ ê¸°ì–µí•´ë‘¬ìš”.

---

## Reactì—ì„œ ì´ê²Œ ì™œ ë¬¸ì œê°€ ë ê¹Œìš”?

React ì»´í¬ë„ŒíŠ¸ëŠ” ìƒíƒœê°€ ë°”ë€” ë•Œë§ˆë‹¤ **ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹¤í–‰**ë¼ìš”. ê·¸ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ í•¨ìˆ˜ë“¤ì´ ë§Œë“¤ì–´ì§€ê³ ìš”.

ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ë„ ë§ˆì°¬ê°€ì§€!

\`\`\`javascript
// countê°€ 0ì¼ ë•Œ ë Œë”ë§ë˜ë©´...
function handleClick() {
  // ì´ í•¨ìˆ˜ëŠ” count=0ì¸ ìˆœê°„ì„ "ì‚¬ì§„"ìœ¼ë¡œ ì°ì–´ë‘ !
  setCount(count + 1);  // "0 + 1 = 1ë¡œ í•´ì¤˜"
  setCount(count + 1);  // "0 + 1 = 1ë¡œ í•´ì¤˜" (ê°™ì€ ì‚¬ì§„!)
  setCount(count + 1);  // "0 + 1 = 1ë¡œ í•´ì¤˜" (ë˜ ê°™ì€ ì‚¬ì§„!)
}
\`\`\`

ì„¸ ë²ˆ ë‹¤ **ê°™ì€ ì˜¤ë˜ëœ ì‚¬ì§„(count=0)**ì„ ë³´ê³  ìˆì–´ìš”. ê·¸ë˜ì„œ ê²°ê³¼ëŠ” 1!

---

## "Stale Closure" ë¬¸ì œë¼ê³  ë¶ˆëŸ¬ìš” ğŸ¥€

"Stale"ì€ "ìƒí•œ", "ì˜¤ë˜ëœ"ì´ë¼ëŠ” ëœ»ì´ì—ìš”. í•¨ìˆ˜ê°€ **ì´ë¯¸ ì˜¤ë˜ëœ ê°’ì„ ì°¸ì¡°**í•˜ê³  ìˆëŠ” ê±°ì£ .

ë¹µì§‘ ë¹„ìœ ë¥¼ ë“¤ì–´ë³¼ê²Œìš” ğŸ¥–

ì—¬ëŸ¬ë¶„: "ë°”ê²ŒíŠ¸ 3ê°œ ì£¼ì„¸ìš”!"
ì§ì›: "ë°”ê²ŒíŠ¸ 1ê°œìš”~"
ì—¬ëŸ¬ë¶„: "????"

ì™œëƒë©´ ì§ì›ì´ "ë°”ê²ŒíŠ¸"ë¼ëŠ” ì²« ë§ˆë””ë§Œ ë“£ê³ , ë‚˜ë¨¸ì§€ëŠ” ë¬´ì‹œí–ˆê±°ë“ ìš”. Reactë„ ë¹„ìŠ·í•´ìš”. ì„¸ ë²ˆ ë§í•´ë„ ë‹¤ ê°™ì€ "ì˜¤ë˜ëœ" count ê°’ë§Œ ë³´ê³  ìˆëŠ” ê±°ì˜ˆìš”.

---

## ì–¸ì œ ì´ëŸ° ì¼ì´ ìƒê¸¸ê¹Œìš”? ğŸš¨

ì‹¤ë¬´ì—ì„œ ìì£¼ ë§ˆì£¼ì¹˜ëŠ” ìƒí™©ë“¤ì´ì—ìš”:

**1. íƒ€ì´ë¨¸ ì•ˆì—ì„œ**  
1ì´ˆ í›„ì— countë¥¼ ì˜¬ë¦¬ëŠ”ë°, ê·¸ 1ì´ˆ ë™ì•ˆ ë²„íŠ¼ì„ ë§‰ ëˆŒë €ì–´ë„ ì²˜ìŒ ê°’ë§Œ ê¸°ì–µí•´ìš”.

**2. ë¹ ë¥¸ ì—°ì† í´ë¦­**  
ì¢‹ì•„ìš” ë²„íŠ¼ì„ ë¹ ë¥´ê²Œ 5ë²ˆ ëˆŒë €ëŠ”ë° 1~2ê°œë§Œ ë°˜ì˜ë¼ìš”.

**3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ**
ìŠ¤í¬ë¡¤í•  ë•Œë§ˆë‹¤ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ”ë°, ê³„ì† ì˜›ë‚  ìƒíƒœë§Œ ë³´ì—¬ìš”.

---

## í•¨ìˆ˜í˜• ì—…ë°ì´í„°ê°€ í•´ê²°í•´ì¤˜ìš”! ğŸ¦¸

í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì“°ë©´, ê°’ì´ ì•„ë‹ˆë¼ **"ê³„ì‚° ë°©ë²•"**ì„ ì „ë‹¬í•´ìš”:

\`\`\`javascript
setCount(prev => prev + 1);  // "ê°€ì¥ ìµœì‹  ê°’ì— 1 ë”í•´ì¤˜!"
\`\`\`

Reactê°€ ì§ì ‘ ê°€ì¥ ìµœì‹  ìƒíƒœë¥¼ ë„£ì–´ì£¼ë‹ˆê¹Œ, ì„¸ ë²ˆ í˜¸ì¶œí•˜ë©´ 0â†’1â†’2â†’3ìœ¼ë¡œ ì •í™•íˆ ì¦ê°€í•´ìš”! âœ…

ì´ê²Œ í•¨ìˆ˜í˜• ì—…ë°ì´í„°ì˜ í•µì‹¬ì´ì—ìš”: **"ìµœì‹  ìƒíƒœëŠ” Reactê°€ ì±…ì„ì ¸ì¤„ê²Œ!"** ğŸ¯`,
      chapterIndex: 2,
      totalChapters: 3,
      estimatedSeconds: 180,
      intent: "EXPLAIN",
    },

    // ============================================================
    // 3. ì´í•´ë„ ì²´í¬: 4ì§€ì„ ë‹¤ í€´ì¦ˆ
    // ============================================================
    {
      id: "check-1",
      type: "CHECK",
      question: "í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ëŠ” ì–¸ì œì¸ê°€ìš”?",
      options: [
        "í•­ìƒ ëª¨ë“  setStateì—ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤",
        "ìƒˆë¡œìš´ ê°’ì´ ì´ì „ ìƒíƒœì— ì˜ì¡´í•  ë•Œ",
        "ìƒíƒœê°€ ê°ì²´ë‚˜ ë°°ì—´ì¼ ë•Œë§Œ",
        "useEffect ë‚´ë¶€ì—ì„œë§Œ",
      ],
      answerIndex: 1,
      explanation:
        "ìƒˆë¡œìš´ ìƒíƒœ ê°’ì´ ì´ì „ ìƒíƒœì— ì˜ì¡´í•  ë•Œ í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆ: ì¹´ìš´í„° ì¦ê°€, ë°°ì—´ì— ì•„ì´í…œ ì¶”ê°€, í† ê¸€ ë“±. ë…ë¦½ì ì¸ ìƒˆ ê°’ì„ ì„¤ì •í•  ë•ŒëŠ” í•„ìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.",
      estimatedSeconds: 45,
      intent: "RETRIEVAL",
    },

    // ============================================================
    // 3. ì´í•´ë„ ì²´í¬: í”Œë˜ì‹œì¹´ë“œ
    // ============================================================
    {
      id: "flashcard-1",
      type: "FLASHCARD",
      front:
        "setCount(count + 1)ì„ ì„¸ ë²ˆ ì—°ì† í˜¸ì¶œí–ˆì„ ë•Œ countê°€ 1ì´ ë˜ëŠ” ì´ìœ ëŠ”?",
      back: "JavaScript í´ë¡œì € ë•Œë¬¸!\n\nì„¸ ë²ˆì˜ í˜¸ì¶œ ëª¨ë‘ ê°™ì€ ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸ì˜ count ê°’(0)ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.\n\ní•´ê²°: setCount(prev => prev + 1) ì‚¬ìš©\n\ní•¨ìˆ˜í˜• ì—…ë°ì´í„°ëŠ” Reactê°€ 'íì‰ëœ ì‹œì ì˜ ìµœì‹  ìƒíƒœ'ë¥¼ ì „ë‹¬í•´ì£¼ë¯€ë¡œ ì •í™•íˆ ë™ì‘í•©ë‹ˆë‹¤.",
      estimatedSeconds: 45,
      intent: "RETRIEVAL",
    },

    // ============================================================
    // 3. ì´í•´ë„ ì²´í¬: Cloze (ë¹ˆì¹¸ ë§íˆê¸°)
    // ============================================================
    {
      id: "cloze-1",
      type: "CLOZE",
      sentence:
        "ë°°ì—´ì— ìƒˆ ì•„ì´í…œì„ ì¶”ê°€í•  ë•Œ: setItems({{blank}} => [...{{blank}}, newItem])",
      blankId: "prev",
      options: ["prev", "items", "state", "array"],
      answerIndex: 0,
      explanation:
        "í•¨ìˆ˜í˜• ì—…ë°ì´í„°ì—ì„œ prevëŠ” ì´ì „ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê´€ë¡€ì ì¸ ì´ë¦„ì…ë‹ˆë‹¤. ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ ê¸°ì¡´ ë°°ì—´ì„ ë³µì‚¬í•˜ê³  ìƒˆ ì•„ì´í…œì„ ì¶”ê°€í•©ë‹ˆë‹¤.",
      estimatedSeconds: 30,
      intent: "RETRIEVAL",
    },

    // ============================================================
    // 2. ê°œë… í•™ìŠµ - ì±•í„° 3: ë°°ì¹˜ ì—…ë°ì´íŠ¸
    // ============================================================
    {
      id: "concept-3",
      type: "CONCEPT",
      title: "Reactì˜ ë°°ì¹˜ ì—…ë°ì´íŠ¸",
      content: `ë“œë””ì–´ ë§ˆì§€ë§‰ ì±•í„°ì˜ˆìš”! ì—¬ê¸°ê¹Œì§€ ì •ë§ ì˜ ë”°ë¼ì˜¤ì…¨ì–´ìš” ğŸ’ª

## ì ê¹, ê¶ê¸ˆí•œ ê²Œ ìƒê¸°ì§€ ì•Šì•˜ë‚˜ìš”? ğŸ¤”

ì§€ê¸ˆê¹Œì§€ ë°°ìš°ë©´ì„œ ì´ëŸ° ìƒê°ì´ ë“¤ì—ˆì„ ìˆ˜ë„ ìˆì–´ìš”:

"ReactëŠ” ì™œ ìƒíƒœë¥¼ ë°”ë¡œë°”ë¡œ ì•ˆ ë°”ê¾¸ê³  ë‚˜ì¤‘ì— ëª¨ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ê±°ì§€?"

ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš”! ì´ê²Œ ë°”ë¡œ **ë°°ì¹˜ ì—…ë°ì´íŠ¸(Batch Update)**ì˜ˆìš”.

---

## ì‹ë‹¹ ë¹„ìœ ë¡œ ì„¤ëª…í•´ë“œë¦´ê²Œìš” ğŸ•

ì‹ë‹¹ì—ì„œ ì£¼ë¬¸ì„ ë°›ëŠ” ìƒí™©ì„ ìƒìƒí•´ë³´ì„¸ìš”.

ì†ë‹˜ì´ "ì½œë¼ìš”", "í”¼ììš”", "ìƒëŸ¬ë“œìš”" í•˜ê³  ë”°ë¡œë”°ë¡œ ë§í•  ë•Œë§ˆë‹¤ ì£¼ë°©ì— ë›°ì–´ê°„ë‹¤ë©´? ì›¨ì´í„°ëŠ” ì„¸ ë²ˆì´ë‚˜ ì™”ë‹¤ê°”ë‹¤í•´ì•¼ í•˜ê³ , ì£¼ë°©ë„ í˜¼ë€ìŠ¤ëŸ¬ì›Œìš”.

í˜„ëª…í•œ ì›¨ì´í„°ë¼ë©´?

**ì£¼ë¬¸ì„ ë‹¤ ë°›ê³  â†’ í•œ ë²ˆì— ì£¼ë°©ì— ì „ë‹¬!** í›¨ì”¬ íš¨ìœ¨ì ì´ì£ ?

Reactë„ ë˜‘ê°™ì•„ìš”. ë²„íŠ¼ í´ë¦­ ì•ˆì—ì„œ setStateë¥¼ ì—¬ëŸ¬ ë²ˆ í•´ë„, **ë‹¤ ëª¨ì•„ì„œ í•œ ë²ˆì— í™”ë©´ì„ ì—…ë°ì´íŠ¸**í•´ìš”.

---

## ì™œ ì´ë ‡ê²Œ í• ê¹Œìš”?

**1. ì„±ëŠ¥!** âš¡  
í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” ê±´ ë¹„ìš©ì´ ë“¤ì–´ìš”. ì„¸ ë²ˆ ë°”ê¿¨ë‹¤ê³  ì„¸ ë²ˆ ê·¸ë¦¬ë©´ ë‚­ë¹„ì£ .

**2. ì¼ê´€ì„±!** ğŸ¯  
ì´ë¦„ì´ë‘ ì´ë©”ì¼ì„ ë™ì‹œì— ë°”ê¾¸ëŠ”ë°, ì´ë¦„ë§Œ ë°”ë€ ì–´ì¤‘ê°„í•œ ìƒíƒœê°€ ë³´ì´ë©´ ì–´ìƒ‰í•˜ì–ì•„ìš”?

**3. ë¶€ë“œëŸ¬ì›€!** âœ¨  
ê¹œë¹¡ê¹œë¹¡ ëœì»¹ê±°ë¦¬ëŠ” UIë³´ë‹¤ ë§¤ë„ëŸ½ê²Œ ì „í™˜ë˜ëŠ” ê²Œ í›¨ì”¬ ì¢‹ì£ !

---

## React 18ì—ì„œ ë” ì¢‹ì•„ì¡Œì–´ìš”! ğŸ‰

ì˜ˆì „(React 17)ì—ëŠ” ë°°ì¹˜ê°€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì•ˆì—ì„œë§Œ ëì–´ìš”. setTimeoutì´ë‚˜ fetch ì½œë°± ì•ˆì—ì„  ì•ˆ ëì£ .

**React 18**ë¶€í„°ëŠ”ìš”?

**ì–´ë””ì„œë“  ìë™ìœ¼ë¡œ ë°°ì¹˜!** íƒ€ì´ë¨¸ ì•ˆì—ì„œë„, API ì‘ë‹µ ë°›ì€ í›„ì—ë„, ì „ë¶€ ë‹¤ìš”!

ì´ì œ "ì—¬ê¸°ì„  ë°°ì¹˜ ë˜ë‚˜?" ê³ ë¯¼í•  í•„ìš” ì—†ì–´ìš”. Reactê°€ ì•Œì•„ì„œ í•´ì¤˜ìš” ğŸ™Œ

---

## ë°°ì¹˜ + í•¨ìˆ˜í˜• ì—…ë°ì´í„° = ìµœê°• ì½¤ë³´ ğŸ’

ë‘ ê°œë…ì€ ë‹¤ë¥´ì§€ë§Œ, ê°™ì´ ì“°ë©´ ì‹œë„ˆì§€ê°€ í­ë°œí•´ìš”:

| ë°°ì¹˜ ì—…ë°ì´íŠ¸ | í•¨ìˆ˜í˜• ì—…ë°ì´í„° |
|---|---|
| ë Œë”ë§ íšŸìˆ˜ë¥¼ ì¤„ì—¬ì„œ **ë¹ ë¥´ê²Œ!** | ìƒíƒœ ê³„ì‚°ì„ **ì •í™•í•˜ê²Œ!** |

ê°™ì€ ìƒíƒœë¥¼ ì—¬ëŸ¬ ë²ˆ ì—…ë°ì´íŠ¸í•´ë„:
- ë°°ì¹˜ ë•ë¶„ì— â†’ ë Œë”ë§ì€ í•œ ë²ˆë§Œ!
- í•¨ìˆ˜í˜• ì—…ë°ì´í„° ë•ë¶„ì— â†’ ëª¨ë“  ì—…ë°ì´íŠ¸ê°€ ìˆœì„œëŒ€ë¡œ ì •í™•íˆ!

**ì„±ëŠ¥ë„ ì¢‹ê³ , ì •í™•ì„±ë„ ë³´ì¥!** ğŸ†

---

## ì˜¤ëŠ˜ ë°°ìš´ ê±¸ ì •ë¦¬í•´ë³¼ê²Œìš” ğŸ“

ì„¸ ê°€ì§€ í•µì‹¬ ê°œë…ì„ ìµí˜”ì–´ìš”:

1. **í•¨ìˆ˜í˜• ì—…ë°ì´í„°**  
   â†’ \`prev => prev + 1\`ë¡œ ì•ˆì „í•˜ê²Œ ìƒíƒœ ì—…ë°ì´íŠ¸!

2. **Stale Closure ë¬¸ì œ**  
   â†’ í•¨ìˆ˜ê°€ ì˜›ë‚  ê°’ì„ ì‚¬ì§„ì²˜ëŸ¼ ê¸°ì–µí•´ì„œ ìƒê¸°ëŠ” ë¬¸ì œ

3. **ë°°ì¹˜ ì—…ë°ì´íŠ¸**  
   â†’ Reactê°€ ì—¬ëŸ¬ ì—…ë°ì´íŠ¸ë¥¼ ëª¨ì•„ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬!

ì•ìœ¼ë¡œ ì½”ë“œ ì“¸ ë•Œ **"ì´ì „ ê°’ì´ í•„ìš”í•œê°€?"** ì´ ì§ˆë¬¸ í•˜ë‚˜ë§Œ ê¸°ì–µí•˜ì„¸ìš”. ê·¸ëŸ¬ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ì˜¬ë°”ë¥¸ íŒ¨í„´ì„ ì„ íƒí•˜ê²Œ ë  ê±°ì˜ˆìš”! ğŸ“

ìˆ˜ê³ í•˜ì…¨ì–´ìš”! ë‹¤ìŒ í€´ì¦ˆë¡œ ë°°ìš´ ë‚´ìš©ì„ í™•ì¸í•´ë´ìš”! ğŸš€`,
      chapterIndex: 3,
      totalChapters: 3,
      estimatedSeconds: 180,
      intent: "EXPLAIN",
    },

    // ============================================================
    // 3. ì´í•´ë„ ì²´í¬: ìŠ¤í”¼ë“œ O/X
    // ============================================================
    {
      id: "speed-ox-1",
      type: "SPEED_OX",
      statement:
        "React 18ì—ì„œ setTimeout ë‚´ì˜ ì—¬ëŸ¬ setState í˜¸ì¶œì€ ê°ê° ë³„ë„ì˜ ë Œë”ë§ì„ ìœ ë°œí•œë‹¤.",
      isTrue: false,
      explanation:
        "í‹€ë ¸ìŠµë‹ˆë‹¤! React 18ë¶€í„°ëŠ” setTimeout, Promise ë“± ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ì—ì„œ ìë™ ë°°ì¹­ì´ ì ìš©ë©ë‹ˆë‹¤. ì—¬ëŸ¬ setState í˜¸ì¶œì´ í•˜ë‚˜ì˜ ë Œë”ë§ìœ¼ë¡œ ë¬¶ì…ë‹ˆë‹¤.",
      estimatedSeconds: 30,
      intent: "RETRIEVAL",
    },

    // ============================================================
    // 3. ì´í•´ë„ ì²´í¬: Matching (ì§ì§“ê¸°)
    // ============================================================
    {
      id: "matching-1",
      type: "MATCHING",
      instruction: "ì™¼ìª½ì˜ ê°œë…ê³¼ ì˜¤ë¥¸ìª½ì˜ ì„¤ëª…ì„ ì—°ê²°í•˜ì„¸ìš”.",
      pairs: [
        {
          id: "pair-1",
          left: "í•¨ìˆ˜í˜• ì—…ë°ì´í„°",
          right: "prev => prev + 1",
        },
        {
          id: "pair-2",
          left: "ë°°ì¹˜ ì—…ë°ì´íŠ¸",
          right: "ì—¬ëŸ¬ setStateë¥¼ í•˜ë‚˜ì˜ ë Œë”ë¡œ ë¬¶ìŒ",
        },
        {
          id: "pair-3",
          left: "Stale closure",
          right: "í´ë¡œì €ê°€ ì˜¤ë˜ëœ ê°’ì„ ì°¸ì¡°í•˜ëŠ” ë¬¸ì œ",
        },
        {
          id: "pair-4",
          left: "flushSync",
          right: "ë°°ì¹­ì„ ì¤‘ë‹¨í•˜ê³  ì¦‰ì‹œ ë Œë”ë§",
        },
      ],
      estimatedSeconds: 60,
      intent: "RETRIEVAL",
    },

    // ============================================================
    // 4. ì ìš© í™œë™ 1
    // ============================================================
    {
      id: "application-1",
      type: "APPLICATION",
      scenario: `ë‹¹ì‹ ì€ To-Do ì•±ì„ ê°œë°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ "ì™„ë£Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë‹¤ìŒ ë‘ ê°€ì§€ê°€ ë™ì‹œì— ì¼ì–´ë‚˜ì•¼ í•©ë‹ˆë‹¤:
1. í•´ë‹¹ í•­ëª©ì˜ ì™„ë£Œ ìƒíƒœ í† ê¸€
2. ì™„ë£Œëœ í•­ëª© ìˆ˜ ì¹´ìš´í„° ì—…ë°ì´íŠ¸

í˜„ì¬ ì½”ë“œëŠ” ë¹ ë¥¸ ë”ë¸”í´ë¦­ ì‹œ ì¹´ìš´í„°ê°€ ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
      question: "ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?",
      options: [
        "useState ëŒ€ì‹  useRefë¥¼ ì‚¬ìš©í•œë‹¤",
        "setCompletedCount(prev => prev + 1)ë¥¼ ì‚¬ìš©í•œë‹¤",
        "ê° ì—…ë°ì´íŠ¸ ì‚¬ì´ì— setTimeoutì„ ì¶”ê°€í•œë‹¤",
        "useEffectì—ì„œ ì¹´ìš´í„°ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤",
      ],
      correctIndex: 1,
      feedback:
        "ì •ë‹µì…ë‹ˆë‹¤! í•¨ìˆ˜í˜• ì—…ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ì—°ì† í´ë¦­ì—ì„œë„ ê° ì—…ë°ì´íŠ¸ê°€ ì˜¬ë°”ë¥¸ ì´ì „ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤. useEffectëŠ” ì˜ì¡´ì„± ê´€ë¦¬ê°€ ë³µì¡í•´ì§€ê³ , setTimeout/useRefëŠ” Reactì˜ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´ì—ì„œ ë²—ì–´ë‚©ë‹ˆë‹¤.",
      estimatedSeconds: 90,
      intent: "PRACTICE",
    },

    // ============================================================
    // 4. ì ìš© í™œë™ 2
    // ============================================================
    {
      id: "application-2",
      type: "APPLICATION",
      scenario: `í¼ì—ì„œ ì—¬ëŸ¬ í•„ë“œ(ì´ë¦„, ì´ë©”ì¼, ì „í™”ë²ˆí˜¸)ë¥¼ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. 
ê° í•„ë“œë§ˆë‹¤ ë³„ë„ì˜ useStateë¥¼ ì‚¬ìš©í•˜ë‹ˆ ì½”ë“œê°€ ë³µì¡í•´ì¡Œê³ , 
ê´€ë ¨ ìƒíƒœë“¤ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.
ë˜í•œ "ì œì¶œ ì¤‘", "ì—ëŸ¬", "ì„±ê³µ" ìƒíƒœë„ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.`,
      question: "ì´ ìƒí™©ì—ì„œ ê°€ì¥ ì ì ˆí•œ í•´ê²°ì±…ì€?",
      options: [
        "ëª¨ë“  ìƒíƒœë¥¼ í•˜ë‚˜ì˜ ê±°ëŒ€í•œ ê°ì²´ë¡œ useStateì— ì €ì¥",
        "useReducerë¡œ ìƒíƒœì™€ ì•¡ì…˜ì„ ëª…í™•íˆ ë¶„ë¦¬",
        "ê° í•„ë“œë§ˆë‹¤ useRef ì‚¬ìš©",
        "ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ì…",
      ],
      correctIndex: 1,
      feedback:
        "ì •ë‹µì…ë‹ˆë‹¤! useReducerëŠ” ì—¬ëŸ¬ ìƒíƒœê°€ ì„œë¡œ ì—°ê´€ë˜ì–´ ìˆê³  ìƒíƒœ ì „í™˜ ë¡œì§ì´ ë³µì¡í•  ë•Œ ì í•©í•©ë‹ˆë‹¤. ì•¡ì…˜ ê¸°ë°˜ìœ¼ë¡œ ëª…í™•í•œ ìƒíƒœ ì „í™˜ì„ ì •ì˜í•  ìˆ˜ ìˆê³ , í…ŒìŠ¤íŠ¸ì™€ ë””ë²„ê¹…ë„ ì‰¬ì›Œì§‘ë‹ˆë‹¤.",
      estimatedSeconds: 90,
      intent: "PRACTICE",
    },

    // ============================================================
    // 5. ì„¸ì…˜ ìš”ì•½ (ë§ˆì§€ë§‰ ê³ ì •)
    // ============================================================
    {
      id: "session-summary",
      type: "SESSION_SUMMARY",
      celebrationEmoji: "ğŸ‰",
      encouragement: "ë©‹ì ¸ìš”! React ìƒíƒœ ê´€ë¦¬ì˜ í•µì‹¬ì„ ì™„ë²½íˆ í•™ìŠµí–ˆìŠµë‹ˆë‹¤!",
      completedActivities: [
        "ê°œë… í•™ìŠµ 3ì±•í„°",
        "4ì§€ì„ ë‹¤ í€´ì¦ˆ 1ê°œ",
        "í”Œë˜ì‹œì¹´ë“œ 1ê°œ",
        "ë¹ˆì¹¸ ì±„ìš°ê¸° 1ê°œ",
        "O/X í€´ì¦ˆ 1ê°œ",
        "ì§ì§“ê¸° 1ê°œ",
        "ì ìš© ë¬¸ì œ 2ê°œ",
      ],
      keyTakeaways: [
        "í•¨ìˆ˜í˜• ì—…ë°ì´í„°: prev => newValueë¡œ stale state ë°©ì§€",
        "ë°°ì¹˜ ì—…ë°ì´íŠ¸: React 18ì—ì„œ ëª¨ë“  ê³³ì—ì„œ ìë™ ì ìš©",
        "useReducer: ë³µì¡í•œ ìƒíƒœ ë¡œì§ì„ ëª…í™•í•˜ê²Œ ê´€ë¦¬",
        "í•µì‹¬ ì§ˆë¬¸: 'ì´ì „ ê°’ì´ í•„ìš”í•œê°€?' â†’ í•¨ìˆ˜í˜• ì—…ë°ì´í„° ì‚¬ìš©",
      ],
      nextSessionPreview: input.nextSessionTitle
        ? {
            title: input.nextSessionTitle,
            description: "useEffectì™€ ë°ì´í„° í˜ì¹­ íŒ¨í„´ì„ ë‹¤ë£¹ë‹ˆë‹¤.",
          }
        : undefined,
      estimatedSeconds: 45,
      intent: "WRAPUP",
    },
  ];

  return {
    schemaVersion: 1,
    blueprintId: input.blueprintId,
    createdAt: input.createdAt,
    context: {
      planId: input.planId,
      moduleId: input.moduleId,
      planSessionId: input.planSessionId,
      sessionType: input.sessionType,
    },
    timeBudget: {
      targetMinutes: input.targetMinutes,
      minMinutes: Math.max(5, Math.floor(input.targetMinutes * 0.6)),
      maxMinutes: Math.min(120, Math.ceil(input.targetMinutes * 1.4)),
      profile: input.profile,
    },
    startStepId: "session-intro",
    steps,
  };
}
