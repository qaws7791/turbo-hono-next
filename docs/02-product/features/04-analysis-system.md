# 학습 자료 분석 시스템 (Analysis System)

## 개요

학습 자료 분석 시스템은 사용자가 업로드한 원시 파일(PDF), URL, 텍스트 등을 "학습 가능한 지식"으로 변환하는 백엔드 처리 파이프라인입니다.
이 시스템은 단순한 파일 저장을 넘어, AI가 이해할 수 있는 형태로 데이터를 가공하고 구조화하여 **학습 계획(Plan) 생성**과 **세션 내 퀴즈/문답**의 기초 데이터를 제공합니다.

---

## 의사결정 근거

- **비동기 처리 필수**: 대용량 PDF나 외부 웹페이지 분석은 시간이 소요되므로, 사용자 경험을 위해 백그라운드 작업으로 분리해야 함
- **재사용성**: 한 번 분석된 문서는 여러 Plan에서 재사용되므로, 분석 결과(임베딩, 요약 등)를 영구적으로 저장해야 함
- **단계적 피드백**: 분석 과정이 블랙박스가 되지 않도록, 사용자에게 상세 진행 상황(Step & Progress)을 실시간으로 제공해야 함

---

## 분석 프로세스 (Pipeline)

자료가 업로드되면 다음과 같은 순차적 단계를 거쳐 처리됩니다.

### 1단계: 수집 및 분류 (Ingestion)

사용자가 제공한 자료의 유형에 따라 적절한 추출기를 선택합니다.

- **File (PDF)**: 텍스트 레이어를 추출하고, 이미지가 포함된 경우 OCR(광학 문자 인식) 등 추가 처리를 준비합니다.
- **URL**: 웹페이지의 본문 텍스트를 스크래핑하고 불필요한 광고/메뉴 등을 제거합니다.
- **Text**: 사용자가 직접 입력한 텍스트를 그대로 사용합니다.

### 2단계: 전처리 및 청킹 (Processing)

AI 모델이 처리하기 적합한 크기로 데이터를 분할합니다.

- **Cleaning**: 특수문자 제어, 중복 공백 제거 등 텍스트 정제
- **Chunking**: 의미 단위 또는 토큰 수 기준으로 텍스트를 작은 조각(Chunk)으로 나눕니다.
  - 너무 작게 자르면 맥락이 끊기고, 너무 크게 자르면 검색 정확도가 떨어지므로 최적의 크기를 유지합니다.

### 3단계: 지식 추출 (Knowledge Extraction)

분할된 데이터에서 의미를 추출하고 AI가 활용할 수 있는 형태로 변환합니다.

- **Embedding**: 각 Chunk를 벡터(숫자 배열)로 변환하여, 나중에 "의미기반 검색(Semantic Search)"이 가능하도록 벡터 DB에 저장합니다.
- **Summarization**: 문서 전체의 핵심 내용을 요약하여 Plan 생성 시 "이 문서가 무엇에 관한 것인지" 파악할 때 사용합니다.
- **Keyword Extraction**: 주요 키워드를 추출하여 태깅 및 필터링에 활용합니다.

### 4단계: 완료 및 저장 (Finalizing)

모든 분석이 완료되면 자료의 상태를 `completed`로 변경하고 사용자가 Plan 생성에 선택할 수 있도록 활성화합니다.

---

## 상태 정의 (Status Definition)

사용자에게 노출되는 자료의 상태는 다음과 같습니다.

| 상태          | 기술적 의미                | 사용자 경험                                                |
| ------------- | -------------------------- | ---------------------------------------------------------- |
| **Pending**   | 업로드 직후, 큐 대기 중    | "분석 대기 중입니다..." 메시지 표시, 로딩 스피너           |
| **Analyzing** | 파이프라인 실행 중 (0~99%) | 진행률 바(Progress Bar) 표시, 상세 단계 메시지 노출        |
| **Completed** | 분석 성공, DB 저장 완료    | Plan 생성 위저드에서 선택 가능, 카드 형태로 내용 확인 가능 |
| **Error**     | 분석 실패                  | 빨간색 에러 상태 표시, 실패 사유(간략) 노출                |
| **Failed**    | (상동)                     |                                                            |

### 상세 진행 단계 (Processing Steps)

분석 중일 때 사용자는 다음과 같은 상세 메시지를 통해 현재 작업을 확인할 수 있습니다.

- `PREPARING`: 업로드 준비 및 초기화
- `VERIFYING`: 파일 유효성 검사
- `LOADING`: 서버로 데이터 로드
- `CHECKING`: 중복 자료 여부 확인 (해시 비교 등)
- `ANALYZING`: **핵심 단계** (청킹, 임베딩, 요약 생성)
- `FINALIZING`: DB 저장 및 마무리

---

## 데이터 구조

분석 시스템이 생성하는 핵심 데이터는 다음과 같습니다.

### Material (학습 자료)

- **ID**: 고유 식별자
- **Source**: 원본 파일 경로 또는 URL
- **Summary**: 전체 요약문 (Plan 생성 프롬프트용)
- **Status**: 현재 처리 상태

### Document Chunk (지식 조각)

- **Content**: 분할된 본문 텍스트
- **Vector**: 임베딩 벡터 (검색용)
- **Order**: 문서 내 위치 순서

---

## 에러 처리

- **재시도**: 일시적인 네트워크 오류나 AI API 타임아웃 시 일정 횟수 자동 재시도합니다.
- **사용자 알림**: 최종 실패 시 UI 카드에 "처리 실패"를 명확히 표시합니다.
- **복구**: 현재 자동 복구 기능은 제한적이며, 실패 시 자료를 삭제하고 다시 업로드하는 것이 권장됩니다.
