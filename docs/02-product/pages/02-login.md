# 로그인 페이지 (/login)

## 개요

로그인 페이지는 **기존 사용자의 빠른 진입**과 **신규 사용자의 간편한 가입**을 동시에 지원합니다.

---

## 의사결정 근거

- **Passwordless 인증**: 마찰 최소화 및 보안성 강화 (이메일 매직링크)
- **Google OAuth (PKCE)**: 안전하고 표준화된 소셜 로그인 제공
- **Calm Focus UI**: `md:grid-cols-2` 레이아웃과 `muted` 테마를 활용한 차분한 디자인

---

## 라우팅 규칙

| 경로           | 설명                             |
| -------------- | -------------------------------- |
| `/login`       | 로그인 페이지 진입               |
| 로그인 성공 후 | `/home` (또는 `redirectTo` 경로) |

### 진입 및 리다이렉트

- 로그인 상태에서 `/login` 진입 시 `/home`으로 자동 리다이렉트
- 미로그인 상태에서 보호된 라우트 진입 시 `/login?redirectTo=...`로 이동
- `redirectTo` 경로는 서버측 Allowlist 기반으로 검증됨

---

## 레이아웃

### 데스크톱 (2컬럼)

- 좌측: 인증 카드 (Google 로그인, 구분선, 이메일 입력)
- 우측: 브랜드 이미지 영역 (`bg-muted rounded-2xl`)

### 모바일 (1컬럼)

- 상단: 인증 카드 및 헤드라인
- 하단: 이용약관 및 개인정보처리방침 링크

---

## 인증 구성 요소

### 1. Google 로그인

- 버튼: "Google로 계속하기"
- 보안: PKCE(Proof Key for Code Exchange) 적용
- 오류 처리: `access_denied`, `state_mismatch`, `missing_code` 등 상세 에러 메시지 제공

### 2. 이메일 매직링크

- **입력**: 이메일 주소 (`you@example.com`)
- **검증**: 이메일 형식 체크 ("이메일 형식을 확인하세요.")
- **보안**:
  - 만료 시간: 10분
  - 사용 횟수: 1회용 (소비 시 즉시 무효화)
  - 레이트 리밋: IP당 분당 5회 요청 제한

---

## 상태 설계

### Input 단계 (Idle)

- 이메일 입력 및 기본 검증
- 오류 발생 시 하단에 메시지 표시

### Sending 단계 (Submitting)

- 버튼 내 스피너 표시 및 비활성화

### Sent 단계 (Sent)

- **상태 표시**: "링크를 보냈습니다"
- **정보**: 전송된 이메일 주소 노출
- **재전송**: 30초 카운트다운 타이머 제공 (`00:30` 후 활성화)
- **이메일 주소 변경**: 다시 Idle 상태로 돌아가는 링크 제공

### Callback/Verify 단계

- **토큰 만료**: "토큰이 만료되었습니다. 새 링크를 요청하세요."
- **토큰 재사용**: "이미 사용된 토큰입니다."
- **유효하지 않은 토큰**: "유효하지 않은 토큰입니다."
- **리다이렉트 보호**: 허용되지 않은 경로는 기본값(`/home`)으로 처리

---

## 보안 원칙

### 인증 및 세션

- **매직링크 토큰**: SHA-256 해싱 저장, 10분 만료, 1회용
- **세션 관리**: 로그인 성공 시 새로운 세션 토큰 발행 (HttpOnly, Secure, SameSite=Lax 쿠키)
- **리다이렉트**: `redirectPath`는 도메인 내부 경로만 허용하여 Open Redirect 공격 방지

### 클라이언트 보안

- OAuth 콜백 에러 발생 시 URL 파라미터 자동 정리 및 UI 알림 표시
