# 기술 의사결정 기록 (Decision Log)

## 개요

이 문서는 프로젝트의 핵심 기술 의사결정과 그 근거를 기록합니다. 각 결정은 ADR(Architecture Decision Record) 형식을 따릅니다.

---

## 결정 목록

| ID     | 날짜    | 제목                 | 상태 |
| ------ | ------- | -------------------- | ---- |
| DL-001 | 2025-12 | Plan 문서 참조 방식  | 확정 |
| DL-002 | 2025-12 | RAG 스코프 제한 규칙 | 확정 |
| DL-003 | 2025-12 | 청크 정책            | 확정 |
| DL-004 | 2025-12 | 세션 복구 방식       | 확정 |
| DL-005 | 2025-12 | SRS 파라미터         | 확정 |
| DL-006 | 2025-12 | 좀비 데이터 전략     | 확정 |

---

## DL-001: Plan 문서 참조 방식

### 결정

Plan 생성 시 선택된 문서의 ID를 `plan_source_materials` 테이블에 고정 저장합니다.

### 컨텍스트

- Plan은 생성 시점의 문서 조합을 기반으로 동작해야 함
- 이후 문서 추가/수정이 기존 Plan에 영향을 주지 않아야 함
- 문서 삭제 시에도 진행 중 Plan은 정상 동작해야 함

### 근거

1. **재현성**: 동일한 Plan은 항상 동일한 학습 경험 제공
2. **안정성**: 문서 변경이 진행 중 학습을 방해하지 않음
3. **데이터 무결성**: 좀비 데이터 전략과 연계 가능

### 대안 검토

| 옵션             | 설명                        | 결과                    |
| ---------------- | --------------------------- | ----------------------- |
| 동적 참조        | Plan이 항상 최신 문서 참조  | 기각 - 학습 경험 불안정 |
| 문서 복사        | 문서 전체를 Plan에 복사     | 기각 - 저장 공간 낭비   |
| **ID 고정 참조** | 문서 ID만 저장, 필요시 조회 | 채택                    |

---

## DL-002: RAG 스코프 제한 규칙

### 결정

RAG 검색 시 Plan에 포함된 문서(plan_source_materials)로만 검색 범위를 제한합니다.

### 컨텍스트

- 사용자가 다양한 문서를 가질 수 있음
- AI 답변이 현재 학습과 무관한 내용을 참조하면 혼란 발생
- 검색 범위가 넓어지면 성능 저하

### 근거

1. **관련성**: 현재 학습 맥락에 맞는 답변만 제공
2. **신뢰성**: "근거 일탈" 방지
3. **성능**: 검색 대상 축소로 응답 속도 개선

### 스코프 우선순위

1. **Session 범위**: 현재 세션의 Module 관련 청크 우선
2. **Plan 범위**: Plan 전체 문서
3. **전체 범위**: (향후 확장) 사용자의 전체 문서

---

## DL-003: 청크 정책

### 결정

- **청크 크기**: 500~1000 토큰
- **오버랩**: 100 토큰
- **메타데이터**: materialId, chunkIndex, pageRange, sectionPath

### 컨텍스트

- 너무 작은 청크: 문맥 손실, 검색 노이즈 증가
- 너무 큰 청크: 정밀도 저하, 토큰 비용 증가
- 오버랩 없음: 문맥 단절 위험

### 근거

1. **균형**: 문맥 유지와 정밀도의 균형점
2. **비용 효율**: LLM 토큰 비용 최적화
3. **확장성**: 문서 타입별 조정 가능

### 청크 전략

| 문서 타입 | 청크 기준     | 비고             |
| --------- | ------------- | ---------------- |
| PDF       | 페이지 + 문단 | 페이지 경계 존중 |
| Markdown  | 헤더 기준     | 섹션 단위 우선   |
| 텍스트    | 토큰 수 기준  | 균등 분할        |

---

## DL-004: 세션 복구 방식

### 결정

로컬 스토리지 + 서버 스냅샷 병렬 저장 방식을 채택합니다.

### 컨텍스트

- 사용자가 학습 중 네트워크 끊김 또는 실수로 페이지 이탈 가능
- 입력 중이던 답변/진행 상황 손실은 UX 저하
- 서버만 의존 시 오프라인 복구 불가

### 근거

1. **로컬 우선**: 오프라인에서도 진행 상황 보존
2. **서버 백업**: 디바이스 변경 시에도 복구 가능
3. **충돌 해결**: 서버 데이터 우선, 로컬은 fallback

### 저장 데이터

```typescript
interface SessionProgressSnapshot {
  sessionRunId: string;
  stepIndex: number;
  inputs: Record<string, any>; // 사용자 입력
  timestamp: string;
}
```

---

## DL-005: SRS 파라미터

### 결정

SM-2 알고리즘 기반의 Spaced Repetition을 적용합니다.

### 컨텍스트

- 학습 내용의 장기 기억화가 목표
- 개인별 학습 속도/기억력 차이 존재
- 복잡한 설정 없이도 효과적이어야 함

### 근거

1. **검증됨**: SM-2는 수십 년간 검증된 알고리즘
2. **단순성**: 복잡한 파라미터 튜닝 불필요
3. **적응성**: 사용자 응답에 따라 자동 조정

### 파라미터

| 파라미터         | 기본값 | 설명             |
| ---------------- | ------ | ---------------- |
| Initial Interval | 1일    | 첫 복습 간격     |
| Initial Ease     | 2.5    | 초기 난이도 계수 |
| Min Ease         | 1.3    | 최소 난이도 계수 |

### Rating → Interval 규칙

| Rating | 간격 변화    | Ease 변화 |
| ------ | ------------ | --------- |
| AGAIN  | 1일로 리셋   | -0.2      |
| HARD   | × 1.2        | -0.15     |
| GOOD   | × ease       | 변동 없음 |
| EASY   | × ease × 1.3 | +0.15     |

---

## DL-006: 좀비 데이터 전략

### 결정

소프트 삭제 + Garbage Collection 방식을 채택합니다.

### 컨텍스트

- 사용자가 문서 삭제 시 목록에서 즉시 제거되기를 원함
- 진행 중인 Plan이 해당 문서를 참조하면 삭제 불가
- 두 요구사항이 충돌

### 근거

1. **UX 우선**: 사용자에게는 즉시 삭제된 것처럼 보임
2. **무결성 보장**: 시스템은 참조가 해제될 때까지 유지
3. **자동 정리**: Plan 완료 시 자동 GC 실행

### 상세

상세 내용은 [학습 자료 삭제 정책](./policies/material-deletion.md) 참조

---

## 변경 이력

| 날짜    | 변경 내용 | 담당자 |
| ------- | --------- | ------ |
| 2025-12 | 초기 작성 | -      |

---

## 관련 문서

- [시스템 아키텍처](./architecture.md)
- [데이터 모델](./data-models.md)
- [ADR 문서들](./adr/)
